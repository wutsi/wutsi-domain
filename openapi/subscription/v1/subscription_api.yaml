openapi: "3.0.0"
info:
  title: "Wutsi Subscription API"
  description: |
    This API manages paid subscriptions
  version: "1.0.0"

servers:
  - url: https://wutsi-subscription-test.herokuapp.com
    description: Sandbox
  - url: https://wutsi-subscription-prod.herokuapp.com
    description: Production

paths:
  /v1/plans:
    post:
      operationId: "create-plan"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreatePlanRequest'
      responses:
        200:
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CreatePlanResponse"
      security:
        - api_key: [ 'subscription' ]
      tags:
        - Plan

  /v1/plans/{plan-id}:
    post:
      operationId: "update-plan"
      parameters:
        - in: path
          name: plan-id
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdatePlanRequest'
      responses:
        200:
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UpdatePlanResponse"
      security:
        - api_key: [ 'subscription' ]
      tags:
        - Plan

    get:
      operationId: "get-plan"
      parameters:
        - in: path
          name: plan-id
          required: true
          schema:
            type: integer
            format: int64
      responses:
        200:
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GetPlanResponse"
      security:
        - api_key: [ 'subscription' ]
      tags:
        - Plan


  /v1/subscriptions:
    post:
      operationId: "create-subscription"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateSubscriptionRequest'
      responses:
        200:
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CreateSubscriptionResponse"
      security:
        - api_key: [ 'subscription' ]
      tags:
        - Subscription


  /v1/partners/{partner-id}/plans:
    get:
      operationId: "partner-plans"
      parameters:
        - in: path
          name: partner-id
          required: true
          schema:
            type: integer
            format: int64
      responses:
        200:
          description: Success
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SearchPlanResponse'
      security:
        - api_key: [ 'subscription' ]
      tags:
        - Partner

  /v1/partners/{partner-id}/subscriptions:
    get:
      operationId: "partner-subscriptions"
      parameters:
        - in: path
          name: partner-id
          required: true
          schema:
            type: integer
            format: int64
      responses:
        200:
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SearchSubscriptionResponse"
      security:
        - api_key: [ 'subscription' ]
      tags:
        - Partner


components:
  securitySchemes:
    api_key:
      type: apiKey
      in: header
      name: Authorization

  schemas:
    CreatePlanRequest:
      type: object
      properties:
        partnerId:
          type: integer
          format: int64
        name:
          type: string
        description:
          type: string
        price:
          type: object
          $ref: "#/components/schemas/PlanPrice"
      required:
        - partnerId
        - name

    CreatePlanResponse:
      type: object
      properties:
        planId:
          type: integer
          format: int64


    UpdatePlanRequest:
      type: object
      properties:
        name:
          type: string
        description:
          type: string
        active:
          type: boolean
        price:
          type: object
          $ref: "#/components/schemas/PlanPrice"
      required:
        - name
        - status

    UpdatePlanResponse:
      type: object
      properties:
        planId:
          type: integer
          format: int64


    GetPlanResponse:
      type: object
      properties:
        plan:
          type: object
          $ref: "#/components/schemas/Plan"

    SearchPlanResponse:
      type: object
      properties:
        plans:
          type: array
          items:
            $ref: "#/components/schemas/Plan"

    Plan:
      type: object
      properties:
        id:
          type: integer
          format: int64
        partnerId:
          type: integer
          format: int64
        name:
          type: string
        description:
          type: string
        active:
          type: boolean
          default: true
        price:
          type: object
          $ref: "#/components/schemas/PlanPrice"

    PlanPrice:
      type: object
      properties:
        monthlyAmount:
          type: integer
          format: int64
          minimum: 1
        yearlyAmount:
          type: integer
          format: int64
          minimum: 1
        currency:
          type: string
      required:
        - currency


    CreateSubscriptionRequest:
      type: object
      properties:
        planId:
          type: integer
          format: int64
        subscriberId:
          type: integer
          format: int64

    CreateSubscriptionResponse:
      type: object
      properties:
        subscriptionId:
          type: integer
          format: int64


    SearchSubscriptionResponse:
      type: object
      properties:
        subscriptions:
          type: array
          items:
            $ref: "#/components/schemas/Subscription"

    GetSubscriptionResponse:
      type: object
      properties:
        subscription:
          type: object
          $ref: "#/components/schemas/Subscription"

    Subscription:
      type: object
      properties:
        id:
          type: integer
          format: int64
        planId:
          type: integer
          format: int64
        subscriberId:
          type: integer
          format: int64
        startDate:
          type: string
          format: date
        endDate:
          type: string
          format: date
        status:
          type: string
          description: "PENDING | ACTIVE | CANCELLED | EXPIRED"
        price:
          type: object
          $ref: "#/components/schemas/Price"
        subscriptionDateTime:
          type: string
          format: date-time

    Price:
      type: object
      properties:
        amount:
          type: integer
          format: int64
        currency:
          type: string
